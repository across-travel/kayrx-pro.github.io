<h1 id="http2">HTTP2</h1>
<p><code>kayrx::web</code> 如有可能, 自动将连接升级到HTTP / 2.0.</p>
<h2 id="tls">TLS</h2>
<p><code>SSL</code>服务器：<code>rustls</code> , 该 rustls 适用于 <code>rustls</code>集成</p>
<pre><code class="language-toml"><div><span class="hljs-section">\[dependencies]</span>
<span class="hljs-attr">kayrx</span> = <span class="hljs-string">"0.7.5"</span>
<span class="hljs-attr">rustls</span> = <span class="hljs-string">"0.16"</span>
</div></code></pre>
<pre><code class="language-rust"><div><span class="hljs-keyword">use</span> std::fs::File;
<span class="hljs-keyword">use</span> std::io::BufReader;
<span class="hljs-keyword">use</span> kayrx::web::{web, App, HttpRequest, HttpServer, Responder};
<span class="hljs-keyword">use</span> rustls::internal::pemfile::{certs, rsa_private_keys};
<span class="hljs-keyword">use</span> rustls::{NoClientAuth, ServerConfig};

async <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">index</span></span>(_req: HttpRequest) -&gt; <span class="hljs-keyword">impl</span> Responder {
    <span class="hljs-string">"Welcome!"</span>
}

<span class="hljs-meta">#\[kayrx::main]</span>
async <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() -&gt; std::io::<span class="hljs-built_in">Result</span>&lt;()&gt; {
    <span class="hljs-comment">// load ssl keys</span>

    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> config = ServerConfig::new(NoClientAuth::new());
    <span class="hljs-keyword">let</span> cert_file = &amp;<span class="hljs-keyword">mut</span> BufReader::new(File::open(<span class="hljs-string">"cert.pem"</span>).unwrap());
    <span class="hljs-keyword">let</span> key_file = &amp;<span class="hljs-keyword">mut</span> BufReader::new(File::open(<span class="hljs-string">"key.pem"</span>).unwrap());
    <span class="hljs-keyword">let</span> cert_chain = certs(cert_file).unwrap();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> keys = rsa_private_keys(key_file).unwrap();
    config.set_single_cert(cert_chain, keys.remove(<span class="hljs-number">0</span>)).unwrap();

    HttpServer::new(|| App::new().route(<span class="hljs-string">"/"</span>, web::get().to(index)))
        .bind_rustls(<span class="hljs-string">"127.0.0.1:8088"</span>, builder)?
        .run()
        .await
}
</div></code></pre>
<blockquote>
<p>请查看 <a href="https://github.com/kayrx/awesome/tree/master/kayrx-examples/rustls">rustls</a>完整示例.</p>
</blockquote>

[set title Kayrx / http2]
[set doc-section protocol-http2]
[stash doc-content][require raw ../_side.html]